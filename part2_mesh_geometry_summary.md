# Part 2: Построение геометрии конечно-элементной сетки

## Задача
Построение деформированной конечно-элементной сетки с адаптацией к геологическим границам.

## Параметры базовой сетки
- **Размер:** 1176×245 узлов (10×10 м)
- **Область:** 11750×2440 м
- **Всего узлов:** 288120

## Адаптация к геологии
Деформация регулярной сетки в соответствии с топографией 11 геологических поверхностей из файлов `src/Depth_surfaces_for_Fidesys/hrz__*.txt`.

### Геологические поверхности
**Формат файлов `hrz__*.txt`:**
- [индекс_x, индекс_y, координата_x, координата_y, глубина_z]
- 11 поверхностей, ~374k точек каждая

## Профиль моделирования

### Координаты скважин
**Файл:** `src/Координаты скважин.txt`
**Параметры:**
- Профиль: вертикальная плоскость через скважины
- Расстояние между скважинами: ~3215.5 м → 3250 м (коррекция)
- Боковое расширение: 4250 м в каждую сторону
- Размеры: 11750×2440 м

### Профильные сечения поверхностей
**Параметры:**
- Длина: 11750 м
- Шаг: 10 м
- Точки: 1176
- Поверхности: 11

**Результат:** массив [1176×11] с глубинами сечений.

## Построение слоевой модели

### Глубины в скважине 1
**Привязка по скважине 1:**
- Координаты: X=662942.93, Y=1298638.90
- Интерполяция 11 поверхностей в точке скважины
- Результат: глубины границ для стратификации

## Деформация сетки

### Алгоритм
**Координаты:**
- X: регулярная сетка, шаг 10 м  
- Z: деформация по геологическим поверхностям

**Интерполяция между поверхностями:**
```
α = (z₀ - z₁)/(z₂ - z₁)
Z(x) = Z₁(x) + α·[Z₂(x) - Z₁(x)]
```

## Выходные данные

### Файл: `model1_mesh_coords.npz`
- **Массив координат:** [1176×245]
- **X-координаты:** регулярная сетка
- **Z-координаты:** деформированные по геологии
- **Метаданные:** границы слоев, позиции скважин

### Файл: `profile_sections_depths.npz`
- **Профили поверхностей:** [1176×11]
- **Координаты профиля:** X, Y координаты точек
- **Метаданные:** позиции скважин, границы области

### Графические файлы
- `depth_maps_all_surfaces.png` — карты глубин всех поверхностей
- `profile_sections_combined.png` — сводный график сечений
- `grid_structure_visualization.png` — визуализация структуры сетки

## Использование
```python
import numpy as np

# Координаты узлов сетки
grid_data = np.load('model1_mesh_coords.npz')
x_coords = grid_data['x_coordinates']  # [1176]
z_coords = grid_data['z_coordinates']  # [1176×245]

# Профили поверхностей
profile_data = np.load('profile_sections_depths.npz')
depths = profile_data['profile_depths']  # [1176×11]
```

## Управление отображением
```python
SHOW_PLOTS = False  # True - показывать графики, False - только сохранять
```
